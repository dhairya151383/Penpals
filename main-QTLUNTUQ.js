import{a as oe,b as ne,c as re,d as ie,e as ae,f as pe,g as ce,h as me,i as se,j as v}from"./chunk-TRGRSSL6.js";import{a as ue}from"./chunk-IMW4E4JM.js";import{a as le}from"./chunk-2WUMKADO.js";import"./chunk-TL62S5XC.js";import"./chunk-THAV5HDO.js";import"./chunk-UL765BIR.js";import{$a as D,Aa as B,Ab as X,Ca as V,Cb as Y,D as y,Da as G,Ea as H,Eb as R,Fb as d,G as i,Gb as ee,Hb as te,Na as Q,O as $,Oa as p,P as U,Qa as W,_a as P,bb as Z,ea as _,eb as q,ha as k,i as j,ia as l,j as F,l as m,m as x,na as u,qa as g,qb as S,r as s,tb as J,u as A,vb as f,wa as a,xa as r,y as T,ya as C,yb as K,za as z}from"./chunk-NOMZ4WY3.js";import"./chunk-MG3ERZGY.js";var I=class e{constructor(o,t){this.authService=o;this.router=t}canActivate(){return x([this.authService.authReady$,this.authService.user$]).pipe(s(([o])=>o),A(1),m(([o,t])=>t?!0:(this.router.navigate(["/login"]),!1)))}static \u0275fac=function(t){return new(t||e)(i(v),i(d))};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};var h=class e{constructor(o,t,n){this.authService=o;this.firestore=t;this.router=n}canActivate(o){let t=o.data.expectedRole,n=o.data.allowSelfEdit===!0,c=o.paramMap.get("id");return x([this.authService.authReady$,this.authService.user$]).pipe(s(([L])=>L),A(1),T(([L,E])=>{if(!E)return this.router.navigate(["/login"]),F(!1);let Ce=ce(this.firestore,`users/${E.uid}`);return j(me(Ce)).pipe(m(be=>{let b=be.data()?.roles;return b?b.admin||n&&c&&c===E.uid&&b[t]||t&&b[t]?!0:(console.warn("Access Denied: User lacks role:",t||"general access"),this.router.navigate(["/"]),!1):(this.router.navigate(["/"]),!1)}))}))}static \u0275fac=function(t){return new(t||e)(i(v),i(ae),i(d))};static \u0275prov=y({token:e,factory:e.\u0275fac,providedIn:"root"})};function Ae(e,o){e&1&&(a(0,"a",8),p(1,"Create Post"),r())}function ye(e,o){if(e&1){let t=V();z(0),a(1,"span",9),p(2),r(),a(3,"button",10),G("click",function(){$(t);let c=H();return U(c.authService.signOut())}),p(4,"Logout"),r(),B()}if(e&2){let t=o.ngIf;_(2),W("Welcome, ",t.displayName||t.email,"")}}function _e(e,o){e&1&&(a(0,"a",11),p(1,"Login"),r())}var O=class e{constructor(o){this.authService=o;this.canCreateOrEdit$=this.authService.user$.pipe(m(t=>{if(!t)return!1;let n=t;return n.roles?.admin===!0||n.roles?.author===!0}))}canCreateOrEdit$;static \u0275fac=function(t){return new(t||e)(k(v))};static \u0275cmp=l({type:e,selectors:[["app-nav"]],decls:13,vars:7,consts:[["loginButton",""],[1,"nav-bar"],[1,"container"],["routerLink","/dashboard",1,"logo"],[1,"nav-links"],["routerLink","/authors",1,"nav-link"],["routerLink","/create-article","class","nav-link",4,"ngIf"],[4,"ngIf","ngIfElse"],["routerLink","/create-article",1,"nav-link"],[1,"welcome-text"],[1,"btn","btn-logout",3,"click"],["routerLink","/login",1,"btn","btn-login"]],template:function(t,n){if(t&1&&(a(0,"nav",1)(1,"div",2)(2,"a",3),p(3,"Dashboard"),r(),a(4,"div",4)(5,"a",5),p(6,"Authors"),r(),u(7,Ae,2,0,"a",6),P(8,"async"),u(9,ye,5,1,"ng-container",7),P(10,"async"),u(11,_e,2,0,"ng-template",null,0,Z),r()()()),t&2){let c=Q(12);_(7),g("ngIf",D(8,3,n.canCreateOrEdit$)),_(2),g("ngIf",D(10,5,n.authService.user$))("ngIfElse",c)}},dependencies:[f,S,J,ee],styles:[".container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 16px;display:flex;justify-content:space-between;align-items:center}.nav-bar[_ngcontent-%COMP%]{background-color:#2d3748;color:#fff;padding:12px 0;box-shadow:0 2px 4px #0000001a}.logo[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fff;text-decoration:none}.nav-links[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.nav-link[_ngcontent-%COMP%]{color:#fff;text-decoration:none;font-size:1rem;transition:color .2s ease-in-out}.nav-link[_ngcontent-%COMP%]:hover{color:#a0aec0}.welcome-text[_ngcontent-%COMP%]{color:#cbd5e0;margin-right:12px;font-size:.95rem}.btn[_ngcontent-%COMP%]{cursor:pointer;padding:6px 14px;font-size:.9rem;border-radius:4px;border:none;text-decoration:none;display:inline-block;transition:background-color .2s ease-in-out;color:#fff}.btn-logout[_ngcontent-%COMP%]{background-color:#e53e3e}.btn-logout[_ngcontent-%COMP%]:hover{background-color:#c53030}.btn-login[_ngcontent-%COMP%]{background-color:#3182ce}.btn-login[_ngcontent-%COMP%]:hover{background-color:#2b6cb0}"]})};function ke(e,o){e&1&&C(0,"app-nav")}var w=class e{constructor(o){this.router=o;this.router.events.pipe(s(t=>t instanceof Y)).subscribe(t=>{this.showNav=!(t.url==="/login"||t.url==="/register")})}showNav=!0;static \u0275fac=function(t){return new(t||e)(k(d))};static \u0275cmp=l({type:e,selectors:[["app-layout"]],decls:2,vars:1,consts:[[4,"ngIf"]],template:function(t,n){t&1&&(u(0,ke,1,0,"app-nav",0),C(1,"router-outlet")),t&2&&g("ngIf",n.showNav)},dependencies:[f,S,R,O],encapsulation:2})};var he=[{path:"login",loadComponent:()=>import("./chunk-CKSHU3CK.js").then(e=>e.LoginComponent)},{path:"register",loadComponent:()=>import("./chunk-MK4ODNGW.js").then(e=>e.RegisterComponent)},{path:"",component:w,canActivate:[I],children:[{path:"",redirectTo:"dashboard",pathMatch:"full"},{path:"dashboard",loadComponent:()=>import("./chunk-LXIXKUZZ.js").then(e=>e.DashboardComponent)},{path:"articles/:id",loadComponent:()=>import("./chunk-MK6PQAAA.js").then(e=>e.ArticleDetailsComponent)},{path:"create-article",loadComponent:()=>import("./chunk-LMYJ3OGB.js").then(e=>e.ArticleUpsertComponent),canActivate:[h],data:{expectedRole:"author"}},{path:"edit-article/:id",loadComponent:()=>import("./chunk-LMYJ3OGB.js").then(e=>e.ArticleUpsertComponent),canActivate:[h],data:{expectedRole:"author"}},{path:"authors",loadComponent:()=>import("./chunk-QSQHE6FU.js").then(e=>e.AuthorListComponent)},{path:"author/:id",loadComponent:()=>import("./chunk-BC4YHZOF.js").then(e=>e.AuthorDetailsComponent)},{path:"author/edit/:id",loadComponent:()=>import("./chunk-JZDMIW72.js").then(e=>e.AuthorEditComponent),canActivate:[h],data:{expectedRole:"author"}},{path:"**",redirectTo:"dashboard"}]},{path:"**",redirectTo:"login"}];var ge={providers:[q({eventCoalescing:!0}),te(he),X(),oe(()=>ne(le.firebaseConfig)),re(()=>ie()),pe(()=>se()),ue({theme:"snow"})]};var N=class e{title="PenPals";static \u0275fac=function(t){return new(t||e)};static \u0275cmp=l({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(t,n){t&1&&C(0,"router-outlet")},dependencies:[R,f],encapsulation:2})};K(N,ge).catch(e=>console.error(e));
