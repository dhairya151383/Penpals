import{b as De}from"./chunk-TL62S5XC.js";import{a as Ve}from"./chunk-THAV5HDO.js";import{$ as Te,$b as Ue,D as U,F as C,Fb as Ce,G as L,H as T,I as h,J as P,Jb as Pe,K as ve,Kb as G,L as z,Lb as Se,Mb as Re,Nb as Z,Ob as $e,Pb as X,Qb as ye,Rb as Q,Sb as B,T as S,Tb as p,Ub as _e,V as Ie,Vb as Fe,Wb as Ne,X as m,Xb as Oe,Yb as Me,Zb as We,_b as xe,b as _,cb as we,cc as Le,d as pe,db as be,dc as ze,e as fe,f as ge,fb as K,g as V,h as q,i as me,j as Ae,jc as Be,l as Ee,lc as je,uc as He,y as ke}from"./chunk-NOMZ4WY3.js";import{a as de,b as he,h as d}from"./chunk-MG3ERZGY.js";var k=new we("ANGULARFIRE2_VERSION");function F(e,t,r){if(t){if(t.length===1)return t[0];let i=t.filter(a=>a.app===r);if(i.length===1)return i[0]}return r.container.getProvider(e).getImmediate({optional:!0})}var $=(e,t)=>{let r=t?[t]:B(),n=[];return r.forEach(o=>{o.container.getProvider(e).instances.forEach(a=>{n.includes(a)||n.push(a)})}),n},R=function(e){return e[e.SILENT=0]="SILENT",e[e.WARN=1]="WARN",e[e.VERBOSE=2]="VERBOSE",e}(R||{}),qe=K()&&typeof Zone<"u"?R.WARN:R.SILENT;var j=class{zone;delegate;constructor(t,r=ge){this.zone=t,this.delegate=r}now(){return this.delegate.now()}schedule(t,r,n){let o=this.zone,i=function(a){o?o.runGuarded(()=>{t.apply(this,[a])}):t.apply(this,[a])};return this.delegate.schedule(i,r,n)}},v=(()=>{class e{outsideAngular;insideAngular;constructor(){let r=T(m);this.outsideAngular=r.runOutsideAngular(()=>new j(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=r.run(()=>new j(typeof Zone>"u"?void 0:Zone.current,fe))}static \u0275fac=function(n){return new(n||e)};static \u0275prov=U({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Ke=!1;function gt(e,t){!Ke&&(qe>R.SILENT||K())&&(Ke=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),qe>=t&&console.warn(`Firebase API called outside injection context: ${e.name}`)}function mt(e){let t=T(m,{optional:!0});return t?t.runOutsideAngular(()=>e()):e()}function w(e){let t=T(m,{optional:!0});return t?t.run(()=>e()):e()}var At=(e,t,r)=>(...n)=>(t&&setTimeout(t,0),z(r,()=>w(()=>e.apply(void 0,n)))),l=(e,t,r)=>(r||=t?R.WARN:R.VERBOSE,function(){let n,o=arguments,i,a,c;try{i=T(v),a=T(Ie),c=T(ve)}catch{return gt(e,r),e.apply(this,o)}for(let s=0;s<arguments.length;s++)typeof o[s]=="function"&&(t&&(n||=w(()=>a.add())),o[s]=At(o[s],n,c));let u=mt(()=>e.apply(this,o));return t?u instanceof _?u.pipe(q(i.outsideAngular),V(i.insideAngular),De(c)):u instanceof Promise?w(()=>new Promise((s,E)=>{a.run(()=>u).then(D=>z(c,()=>w(()=>s(D))),D=>z(c,()=>w(()=>E(D))))})):typeof u=="function"&&n?function(){return setTimeout(n,0),u.apply(this,arguments)}:w(()=>u):u instanceof _?u.pipe(q(i.outsideAngular),V(i.insideAngular)):w(()=>u)});var A=class{constructor(t){return t}},b=class{constructor(){return B()}};function Et(e){return e&&e.length===1?e[0]:new A(Q())}var Y=new C("angularfire2._apps"),kt={provide:A,useFactory:Et,deps:[[new h,Y]]},vt={provide:b,deps:[[new h,Y]]};function It(e){return(t,r)=>{let n=r.get(Te);p("angularfire",k.full,"core"),p("angularfire",k.full,"app"),p("angular",be.full,n.toString());let o=t.runOutsideAngular(()=>e(r));return new A(o)}}function kr(e,...t){return P([kt,vt,{provide:Y,useFactory:It(e),multi:!0,deps:[m,S,v,...t]}])}var vr=l(ye,!0);var Tt=new Map,wt={activated:!1,tokenObservers:[]},bt={initialized:!1,enabled:!1};function f(e){return Tt.get(e)||Object.assign({},wt)}function Qe(){return bt}var Ct="https://content-firebaseappcheck.googleapis.com/v1";var Pt="exchangeDebugToken",Ge={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},_r=24*60*60*1e3;var te=class{constructor(t,r,n,o,i){if(this.operation=t,this.retryPolicy=r,this.getWaitDuration=n,this.lowerBound=o,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=o,o>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(t){return d(this,null,function*(){this.stop();try{this.pending=new G,this.pending.promise.catch(r=>{}),yield St(this.getNextRun(t)),this.pending.resolve(),yield this.pending.promise,this.pending=new G,this.pending.promise.catch(r=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(r){this.retryPolicy(r)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(t){if(t)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let r=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),r}}};function St(e){return new Promise(t=>{setTimeout(t,e)})}var Rt={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},I=new Re("appCheck","AppCheck",Rt);function Ye(e){if(!f(e).activated)throw I.create("use-before-activation",{appName:e.name})}function Je(n,o){return d(this,arguments,function*({url:e,body:t},r){let i={"Content-Type":"application/json"},a=r.getImmediate({optional:!0});if(a){let g=yield a.getHeartbeatsHeader();g&&(i["X-Firebase-Client"]=g)}let c={method:"POST",body:JSON.stringify(t),headers:i},u;try{u=yield fetch(e,c)}catch(g){throw I.create("fetch-network-error",{originalErrorMessage:g?.message})}if(u.status!==200)throw I.create("fetch-status-error",{httpStatus:u.status});let s;try{s=yield u.json()}catch(g){throw I.create("fetch-parse-error",{originalErrorMessage:g?.message})}let E=s.ttl.match(/^([\d.]+)(s)$/);if(!E||!E[2]||isNaN(Number(E[1])))throw I.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${s.ttl}`});let D=Number(E[1])*1e3,le=Date.now();return{token:s.token,expireTimeMillis:le+D,issuedAtTimeMillis:le}})}function et(e,t){let{projectId:r,appId:n,apiKey:o}=e.options;return{url:`${Ct}/projects/${r}/apps/${n}:${Pt}?key=${o}`,body:{debug_token:t}}}var $t="firebase-app-check-database",yt=1,re="firebase-app-check-store";var H=null;function Dt(){return H||(H=new Promise((e,t)=>{try{let r=indexedDB.open($t,yt);r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{var o;t(I.create("storage-open",{originalErrorMessage:(o=n.target.error)===null||o===void 0?void 0:o.message}))},r.onupgradeneeded=n=>{let o=n.target.result;switch(n.oldVersion){case 0:o.createObjectStore(re,{keyPath:"compositeKey"})}}}catch(r){t(I.create("storage-open",{originalErrorMessage:r?.message}))}}),H)}function _t(e,t){return Ft(Nt(e),t)}function Ft(e,t){return d(this,null,function*(){let n=(yield Dt()).transaction(re,"readwrite"),i=n.objectStore(re).put({compositeKey:e,value:t});return new Promise((a,c)=>{i.onsuccess=u=>{a()},n.onerror=u=>{var s;c(I.create("storage-set",{originalErrorMessage:(s=u.target.error)===null||s===void 0?void 0:s.message}))}})})}function Nt(e){return`${e.options.appId}-${e.name}`}var N=new $e("@firebase/app-check");function J(e,t){return Se()?_t(e,t).catch(r=>{N.warn(`Failed to write token to IndexedDB. Error: ${r}`)}):Promise.resolve()}function tt(){return Qe().enabled}function rt(){return d(this,null,function*(){let e=Qe();if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var Ot={error:"UNKNOWN_ERROR"};function Mt(e){return Pe.encodeString(JSON.stringify(e),!1)}function ne(e,t=!1,r=!1){return d(this,null,function*(){let n=e.app;Ye(n);let o=f(n),i=o.token,a;if(i&&!O(i)&&(o.token=void 0,i=void 0),!i){let s=yield o.cachedTokenPromise;s&&(O(s)?i=s:yield J(n,void 0))}if(!t&&i&&O(i))return{token:i.token};let c=!1;if(tt())try{o.exchangeTokenPromise||(o.exchangeTokenPromise=Je(et(n,yield rt()),e.heartbeatServiceProvider).finally(()=>{o.exchangeTokenPromise=void 0}),c=!0);let s=yield o.exchangeTokenPromise;return yield J(n,s),o.token=s,{token:s.token}}catch(s){return s.code==="appCheck/throttled"||s.code==="appCheck/initial-throttle"?N.warn(s.message):r&&N.error(s),ee(s)}try{o.exchangeTokenPromise||(o.exchangeTokenPromise=o.provider.getToken().finally(()=>{o.exchangeTokenPromise=void 0}),c=!0),i=yield f(n).exchangeTokenPromise}catch(s){s.code==="appCheck/throttled"||s.code==="appCheck/initial-throttle"?N.warn(s.message):r&&N.error(s),a=s}let u;return i?a?O(i)?u={token:i.token,internalError:a}:u=ee(a):(u={token:i.token},o.token=i,yield J(n,i)):u=ee(a),c&&Lt(n,u),u})}function Wt(e){return d(this,null,function*(){let t=e.app;Ye(t);let{provider:r}=f(t);if(tt()){let n=yield rt(),{token:o}=yield Je(et(t,n),e.heartbeatServiceProvider);return{token:o}}else{let{token:n}=yield r.getToken();return{token:n}}})}function xt(e,t,r,n){let{app:o}=e,i=f(o),a={next:r,error:n,type:t};if(i.tokenObservers=[...i.tokenObservers,a],i.token&&O(i.token)){let c=i.token;Promise.resolve().then(()=>{r({token:c.token}),Ze(e)}).catch(()=>{})}i.cachedTokenPromise.then(()=>Ze(e))}function nt(e,t){let r=f(e),n=r.tokenObservers.filter(o=>o.next!==t);n.length===0&&r.tokenRefresher&&r.tokenRefresher.isRunning()&&r.tokenRefresher.stop(),r.tokenObservers=n}function Ze(e){let{app:t}=e,r=f(t),n=r.tokenRefresher;n||(n=Ut(e),r.tokenRefresher=n),!n.isRunning()&&r.isTokenAutoRefreshEnabled&&n.start()}function Ut(e){let{app:t}=e;return new te(()=>d(null,null,function*(){let r=f(t),n;if(r.token?n=yield ne(e,!0):n=yield ne(e),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let r=f(t);if(r.token){let n=r.token.issuedAtTimeMillis+(r.token.expireTimeMillis-r.token.issuedAtTimeMillis)*.5+3e5,o=r.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,o),Math.max(0,n-Date.now())}else return 0},Ge.RETRIAL_MIN_WAIT,Ge.RETRIAL_MAX_WAIT)}function Lt(e,t){let r=f(e).tokenObservers;for(let n of r)try{n.type==="EXTERNAL"&&t.error!=null?n.error(t.error):n.next(t)}catch{}}function O(e){return e.expireTimeMillis-Date.now()>0}function ee(e){return{token:Mt(Ot),error:e}}var oe=class{constructor(t,r){this.app=t,this.heartbeatServiceProvider=r}_delete(){let{tokenObservers:t}=f(this.app);for(let r of t)nt(this.app,r.next);return Promise.resolve()}};function zt(e,t){return new oe(e,t)}function Bt(e){return{getToken:t=>ne(e,t),getLimitedUseToken:()=>Wt(e),addTokenListener:t=>xt(e,"INTERNAL",t),removeTokenListener:t=>nt(e.app,t)}}var jt="@firebase/app-check",Ht="0.10.0";var Vt="app-check",Xe="app-check-internal";function qt(){X(new Z(Vt,e=>{let t=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat");return zt(t,r)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider(Xe).initialize()})),X(new Z(Xe,e=>{let t=e.getProvider("app-check").getImmediate();return Bt(t)},"PUBLIC").setInstantiationMode("EXPLICIT")),p(jt,Ht)}qt();var Kt="app-check";var y=class{constructor(){return $(Kt)}};var Gt=["localhost","0.0.0.0","127.0.0.1"],Vr=typeof window<"u"&&Gt.includes(window.location.hostname);var ot="auth",M=class{constructor(t){return t}},W=class{constructor(){return $(ot)}};var ie=new C("angularfire2.auth-instances");function Zt(e,t){let r=F(ot,e,t);return r&&new M(r)}function Xt(e){return(t,r)=>{let n=t.runOutsideAngular(()=>e(r));return new M(n)}}var Qt={provide:W,deps:[[new h,ie]]},Yt={provide:M,useFactory:Zt,deps:[[new h,ie],A]};function Gn(e,...t){return p("angularfire",k.full,"auth"),P([Yt,Qt,{provide:ie,useFactory:Xt(e),multi:!0,deps:[m,S,v,b,[new h,y],...t]}])}var it=l(Fe,!0,2);var Zn=l(Ue,!0);var se=l(Me,!0);var st=l(Ne,!0,2);var at=l(xe,!0,2);var ct=l(We,!0,2);var ut=l(Oe,!0,2);var x=class{constructor(t){return t}},lt="firestore",ae=class{constructor(){return $(lt)}};var ce=new C("angularfire2.firestore-instances");function Jt(e,t){let r=F(lt,e,t);return r&&new x(r)}function er(e){return(t,r)=>{let n=t.runOutsideAngular(()=>e(r));return new x(n)}}var tr={provide:ae,deps:[[new h,ce]]},rr={provide:x,useFactory:Jt,deps:[[new h,ce],A]};function ai(e,...t){return p("angularfire",k.full,"fst"),P([rr,tr,{provide:ce,useFactory:er(e),multi:!0,deps:[m,S,v,b,[new h,W],[new h,y],...t]}])}var ue=l(Le,!0,2);var dt=l(Be,!0);var ci=l(ze,!0);var ht=l(je,!0,2);var pt=class e{constructor(t,r,n){this.firebaseService=t;this.authorService=r;this.router=n;this.user$=new _(o=>se(this.firebaseService.auth,i=>{o.next(i)})).pipe(ke(o=>{if(o){let i=ue(this.firebaseService.firestore,`users/${o.uid}`);return me(dt(i)).pipe(Ee(a=>{let c=a.data();return he(de({},o),{roles:c?.roles})}))}else return Ae(null)})),se(this.firebaseService.auth,()=>{this.authReady$.next(!0)})}user$;authReady$=new pe(!1);defaultMaleAvatarUrl="assets/images/maleAvatar.jpg";defaultFemaleAvatarUrl="assets/images/femaleAvatar.jpg";defaultGenericAvatarUrl="assets/images/defaultAvatar.jpg";signInWithGoogle(){return d(this,null,function*(){try{let t=new _e,r=yield at(this.firebaseService.auth,t);yield this.saveUserData(r.user,void 0,"google","user",void 0,"unknown")}catch(t){throw console.error("Google Sign-In Error:",t),t}})}signInWithEmail(t,r){return d(this,null,function*(){try{return(yield st(this.firebaseService.auth,t,r)).user}catch(n){throw console.error("Email Sign-In Error:",n),n}})}registerWithEmail(t,r,n,o,i,a){return d(this,null,function*(){try{let c=yield it(this.firebaseService.auth,t,r);if(yield ut(c.user,{displayName:i}),yield this.saveUserData(c.user,n,"email",o,i,a),o==="author"){let u=c.user.photoURL||this.getAvatarUrlByGender(a),s={id:c.user.uid,name:i,avatarUrl:u,createdAt:new Date().toISOString()};yield this.authorService.create(c.user.uid,s)}return c.user}catch(c){throw console.error("Register Error:",c),c}})}signOut(){return d(this,null,function*(){try{yield ct(this.firebaseService.auth)}catch(t){throw console.error("Sign-Out Error:",t),t}finally{this.router.navigate(["/login"])}})}getAvatarUrlByGender(t){return t==="male"?this.defaultMaleAvatarUrl:t==="female"?this.defaultFemaleAvatarUrl:this.defaultGenericAvatarUrl}saveUserData(t,r,n="google",o="user",i,a="unknown"){return d(this,null,function*(){let c={admin:!1,user:!1};o==="author"?c.author=!0:(o==="admin"||o==="user")&&(c[o]=!0);let u=t.photoURL||this.getAvatarUrlByGender(a),s={uid:t.uid,email:t.email||"",username:r||t.displayName||t.email?.split("@")[0]||"anonymous",gender:a,roles:c,createdAt:new Date().toISOString(),profile:{displayName:i||t.displayName||r||"Anonymous User",photoURL:u},provider:n},E=ue(this.firebaseService.firestore,"users",t.uid);yield ht(E,s,{merge:!0})})}static \u0275fac=function(r){return new(r||e)(L(He),L(Ve),L(Ce))};static \u0275prov=U({token:e,factory:e.\u0275fac,providedIn:"root"})};export{kr as a,vr as b,Gn as c,Zn as d,x as e,ai as f,ue as g,dt as h,ci as i,pt as j};
