import{a as D,b as q}from"./chunk-Z5H4QDB3.js";import"./chunk-2WUMKADO.js";import{a as T}from"./chunk-THAV5HDO.js";import{a as B}from"./chunk-IWDVFKXM.js";import{c as U,e as s,f as V,g as G,i as F,j as z,k as j,p as N,r as R}from"./chunk-UL765BIR.js";import{Ca as w,Da as f,Db as I,Ea as g,Fb as L,O as u,Oa as a,P as h,Pa as O,Q as b,Qa as k,R as C,Ra as S,ea as n,ha as _,ia as E,na as p,pa as M,qa as l,qb as y,sa as P,vb as A,wa as i,xa as t,ya as d}from"./chunk-NOMZ4WY3.js";import{h as x}from"./chunk-MG3ERZGY.js";function H(r,o){r&1&&d(0,"app-loading-spinner")}function Z(r,o){if(r&1){let e=w();i(0,"div",34)(1,"p"),a(2),t(),i(3,"button",35),f("click",function(){u(e);let m=g(2);return h(m.error=null)}),a(4,"\u2716"),t()()}if(r&2){let e=g(2);n(2),O(e.error)}}function J(r,o){r&1&&(i(0,"div",36),a(1," Please enter a valid image URL (jpeg, jpg, gif, png, webp). "),t())}function K(r,o){r&1&&(i(0,"div",36),a(1," Name is required. "),t())}function Q(r,o){r&1&&(i(0,"div",36),a(1," Name must be at least 2 characters long. "),t())}function W(r,o){r&1&&(i(0,"div",36),a(1," Name cannot exceed 50 characters. "),t())}function X(r,o){r&1&&(i(0,"div",36),a(1," Please enter a valid Twitter URL (e.g., https://twitter.com/username). "),t())}function Y(r,o){r&1&&(i(0,"div",36),a(1," Please enter a valid LinkedIn URL (e.g., https://www.linkedin.com/in/username). "),t())}function ee(r,o){r&1&&(i(0,"div",36),a(1," Please enter a valid Facebook URL (e.g., https://www.facebook.com/username). "),t())}function te(r,o){r&1&&(i(0,"div",36),a(1," Bio is required. "),t())}function ie(r,o){if(r&1&&(i(0,"div",36),a(1),t()),r&2){let e=g(2);n(),k(" Bio cannot exceed ",e.bioCharacterLimit," characters. ")}}function re(r,o){if(r&1){let e=w();i(0,"div"),p(1,Z,5,1,"div",1),i(2,"form",2),f("ngSubmit",function(){u(e);let m=g();return h(m.save())}),i(3,"div",3)(4,"div",4)(5,"div",5)(6,"h2"),a(7,"Edit Author"),t(),d(8,"hr"),t(),i(9,"div",6)(10,"div",7)(11,"app-upload-image",8),f("imageChange",function(m){u(e);let v=g();return h(v.onImageChange(m))}),t(),p(12,J,2,0,"div",9),t(),i(13,"div",10)(14,"label",11),a(15,"Name"),t(),d(16,"input",12),p(17,K,2,0,"div",9)(18,Q,2,0,"div",9)(19,W,2,0,"div",9),t(),i(20,"div",13)(21,"label"),a(22,"Tags"),t(),i(23,"app-tag-selector",14),f("selectedTagsChange",function(m){u(e);let v=g();return h(v.onTagChange(m))}),t()(),i(24,"button",15),a(25," Save "),t()()(),i(26,"div",16)(27,"div",5)(28,"h3"),a(29,"Author Details"),t(),d(30,"hr"),t(),i(31,"div",17)(32,"label"),a(33,"Social Links"),t(),i(34,"div",18),b(),i(35,"svg",19),d(36,"path",20),t(),C(),d(37,"input",21),p(38,X,2,0,"div",9),t(),i(39,"div",22),b(),i(40,"svg",23),d(41,"path",24),t(),C(),d(42,"input",25),p(43,Y,2,0,"div",9),t(),i(44,"div",26),b(),i(45,"svg",27),d(46,"path",28),t(),C(),d(47,"input",29),p(48,ee,2,0,"div",9),t()(),i(49,"div",30)(50,"label",31),a(51,"Bio"),t(),i(52,"textarea",32),f("input",function(m){u(e);let v=g();return h(v.onBioChanged(m))}),t(),i(53,"div",33),a(54),t(),p(55,te,2,0,"div",9)(56,ie,2,1,"div",9),t()()()()()}if(r&2){let e=g();n(),l("ngIf",e.error),n(),l("formGroup",e.form),n(9),l("type","profilePic")("imageUrl",e.avatarUrl),n(),l("ngIf",(e.formSubmitted||e.avatarUrlControl.touched)&&e.avatarUrlControl.hasError("pattern")),n(5),l("ngIf",(e.formSubmitted||e.name.touched)&&e.name.hasError("required")),n(),l("ngIf",(e.formSubmitted||e.name.touched)&&e.name.hasError("minlength")),n(),l("ngIf",(e.formSubmitted||e.name.touched)&&e.name.hasError("maxlength")),n(4),l("selectedTags",e.tags)("tagType","author")("filterOnly",!1),n(),l("disabled",e.form.invalid||e.loading),n(7),l("formGroup",e.socialLinksGroup),n(7),l("ngIf",(e.formSubmitted||e.twitter.touched)&&e.twitter.hasError("pattern")),n(5),l("ngIf",(e.formSubmitted||e.linkedin.touched)&&e.linkedin.hasError("pattern")),n(5),l("ngIf",(e.formSubmitted||e.facebook.touched)&&e.facebook.hasError("pattern")),n(4),M("maxlength",e.bioCharacterLimit),n(),P("error",e.bioCharacterCount>e.bioCharacterLimit),n(),S(" ",e.bioCharacterCount," / ",e.bioCharacterLimit," characters "),n(),l("ngIf",(e.formSubmitted||e.bio.touched)&&e.bio.hasError("required")),n(),l("ngIf",(e.formSubmitted||e.bio.touched)&&e.bio.hasError("maxlength"))}}var $=class r{constructor(o,e,c,m){this.fb=o;this.authorService=e;this.route=c;this.router=m}form;tags=[];avatarUrl="assets/images/defaultAvatar.jpg";authorId;loading=!0;error=null;formSubmitted=!1;bioCharacterCount=0;bioCharacterLimit=1200;ngOnInit(){this.initializeForm(),this.bio.valueChanges.subscribe(e=>{this.bioCharacterCount=e?e.length:0});let o=this.route.snapshot.paramMap.get("id");o?(this.authorId=o,this.loadAuthorData(o)):(this.error="Invalid author ID provided.",this.loading=!1,this.router.navigate(["/dashboard"]))}initializeForm(){this.form=this.fb.group({name:["",[s.required,s.minLength(2),s.maxLength(50)]],bio:["",[s.required,s.maxLength(this.bioCharacterLimit)]],avatarUrl:["",[s.pattern(/^(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp)(\?.*)?|assets\/images\/.*\.jpg)$/i)]],socialLinks:this.fb.group({twitter:["",[s.pattern(/^(https?:\/\/)?(www\.)?twitter\.com\/[A-Za-z0-9_]{1,15}\/?$/i)]],linkedin:["",[s.pattern(/^(https?:\/\/)?(www\.)?linkedin\.com\/in\/[A-Za-z0-9_-]+\/?$/i)]],facebook:["",[s.pattern(/^(https?:\/\/)?(www\.)?facebook\.com\/[A-Za-z0-9_.]+\/?$/i)]]})})}loadAuthorData(o){return x(this,null,function*(){this.loading=!0,this.error=null;try{let e=yield this.authorService.getById(o);e?(this.tags=(e.tags||[]).map(c=>({name:c,type:"author"})),this.avatarUrl=e.avatarUrl||"assets/images/defaultAvatar.jpg",this.form.patchValue({name:e.name||"",bio:e.bio||"",avatarUrl:e.avatarUrl||"",socialLinks:{twitter:e.socialLinks?.twitter||"",linkedin:e.socialLinks?.linkedin||"",facebook:e.socialLinks?.facebook||""}}),this.bioCharacterCount=e.bio?e.bio.length:0,this.form.updateValueAndValidity()):(this.error="Author not found.",this.router.navigate(["/authors"]))}catch(e){console.error("Failed to load author data:",e),this.error="Failed to load author data. Please try again."}finally{this.loading=!1}})}get name(){return this.form.get("name")}get bio(){return this.form.get("bio")}get avatarUrlControl(){return this.form.get("avatarUrl")}get socialLinksGroup(){return this.form.get("socialLinks")}get twitter(){return this.socialLinksGroup.get("twitter")}get linkedin(){return this.socialLinksGroup.get("linkedin")}get facebook(){return this.socialLinksGroup.get("facebook")}onTagChange(o){this.tags=o}onImageChange(o){this.avatarUrl=o||"assets/images/defaultAvatar.jpg",this.avatarUrlControl.setValue(o),this.avatarUrlControl.markAsDirty(),this.avatarUrlControl.updateValueAndValidity()}onBioChanged(o){this.bio.markAsTouched()}save(){return x(this,null,function*(){if(this.formSubmitted=!0,this.form.markAllAsTouched(),console.log("Attempting to save - Form valid:",this.form.valid),Object.keys(this.form.controls).forEach(e=>{let c=this.form.get(e);c?.invalid&&console.log(`Control '${e}' is invalid. Errors:`,c.errors)}),this.socialLinksGroup.invalid&&Object.keys(this.socialLinksGroup.controls).forEach(e=>{let c=this.socialLinksGroup.get(e);c?.invalid&&console.log(`SocialLink control '${e}' is invalid. Errors:`,c.errors)}),this.form.invalid){this.error="Please correct the highlighted errors before saving.",this.loading=!1;return}this.loading=!0,this.error=null;let o={name:this.form.value.name,bio:this.form.value.bio,avatarUrl:this.avatarUrl,tags:this.tags.map(e=>e.name),socialLinks:this.form.value.socialLinks,updatedAt:new Date().toISOString()};try{yield this.authorService.update(this.authorId,o),this.router.navigate(["/author",this.authorId])}catch(e){console.error("Failed to update author:",e),this.error="Failed to save changes. An unexpected error occurred."}finally{this.loading=!1}})}static \u0275fac=function(e){return new(e||r)(_(N),_(T),_(I),_(L))};static \u0275cmp=E({type:r,selectors:[["app-author-edit"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","global-error-banner",4,"ngIf"],[1,"article-creation-page",3,"ngSubmit","formGroup"],[1,"article-creation-container"],[1,"form-card"],[1,"card-header"],[1,"article-form"],[1,"form-group","avatar-upload"],[3,"imageChange","type","imageUrl"],["class","error",4,"ngIf"],[1,"form-group"],["for","name"],["id","name","type","text","formControlName","name"],[1,"form-group","tag-selector-container"],[3,"selectedTagsChange","selectedTags","tagType","filterOnly"],["type","submit",1,"save-button",3,"disabled"],[1,"editor-card"],[1,"form-group","social-links-group",3,"formGroup"],[1,"social-field","twitter"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","currentColor","aria-label","Twitter icon","role","img"],["d","M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.799-1.574 2.162-2.722-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.594 0 .509.055 1.003.155 1.481-5.399-.27-10.169-2.868-13.376-6.848-.547.934-.863 2.015-.863 3.161 0 2.246 1.14 4.254 2.873 5.429-.846-.026-1.644-.26-2.348-.647v.081c0 3.135 2.224 5.766 5.141 6.363-.428.113-.884.172-1.357.172-.335 0-.65-.035-.96-.092.819 2.564 3.171 4.444 5.955 4.494-2.204 1.73-4.99 2.766-8.02 2.766-.525 0-1.04-.03-1.547-.091 2.844 1.83 6.208 2.897 9.883 2.897 11.836 0 18.307-9.873 18.307-18.307 0-.278-.006-.557-.019-.836.858-.618 1.6-1.394 2.189-2.278z"],["formControlName","twitter","placeholder","Twitter URL"],[1,"social-field","linkedin"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","currentColor","aria-label","LinkedIn icon","role","img"],["d","M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.761 0 5-2.239 5-5v-14c0-2.761-2.239-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"],["formControlName","linkedin","placeholder","LinkedIn URL"],[1,"social-field","facebook"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","currentColor","aria-label","Facebook icon","role","img"],["d","M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.909c0-1.09.272-1.909 1.909-1.909h2.091v-3h-3.159c-3.121 0-4.841 1.716-4.841 4.669v2.331z"],["formControlName","facebook","placeholder","Facebook URL"],[1,"form-group","bio-form-group"],["for","bio"],["id","bio","formControlName","bio","rows","10",1,"bio-textarea",3,"input"],[1,"character-count"],[1,"global-error-banner"],[1,"close-error-button",3,"click"],[1,"error"]],template:function(e,c){e&1&&p(0,H,1,0,"app-loading-spinner",0)(1,re,57,23,"div",0),e&2&&(l("ngIf",c.loading),n(),l("ngIf",!c.loading))},dependencies:[A,y,R,F,U,V,G,z,j,D,B,q],styles:["textarea[_ngcontent-%COMP%]{min-height:200px;resize:vertical}.bio-textarea[_ngcontent-%COMP%]{flex-grow:1;height:auto}.editor-card[_ngcontent-%COMP%]{flex:3;padding:1.5rem 2rem 2rem;display:flex;flex-direction:column;border-left:1px solid #e0e0e0;overflow:hidden}.editor-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:1.25rem;display:flex;flex-direction:column}.bio-form-group[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column;margin-bottom:0}.article-creation-page[_ngcontent-%COMP%]{display:flex;justify-content:center;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;color:#333;margin:2rem 0}.article-creation-container[_ngcontent-%COMP%]{display:flex;width:90vw;background:#fff;border-radius:8px;box-shadow:0 0 10px #00000026;overflow:hidden}.form-card[_ngcontent-%COMP%]{flex:2;padding:1.5rem 2rem;display:flex;flex-direction:column}.card-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-weight:700;color:#2e7d32}.card-header[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{border:none;border-bottom:2px solid #2e7d32;margin-bottom:1rem;width:50px}.author-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:1.25rem;display:flex;flex-direction:column}label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.3rem;color:#2e7d32}input[type=text][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{padding:.5rem .75rem;font-size:1rem;border:1.5px solid #ccc;border-radius:6px;transition:border-color .3s ease;font-family:inherit}input[type=text][_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{border-color:#66bb6a;outline:none;box-shadow:0 0 5px #81c784}.checkbox-group[_ngcontent-%COMP%]{flex-direction:row;align-items:center}.checkbox-group[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-right:.5rem;width:18px;height:18px}.save-button[_ngcontent-%COMP%]{align-self:flex-start;padding:.6rem 1.6rem;background-color:#2e7d32;border:none;border-radius:6px;color:#fff;font-weight:700;font-size:1.1rem;cursor:pointer;transition:background-color .3s ease;margin-top:auto}.save-button[_ngcontent-%COMP%]:disabled{background-color:#a5d6a7;cursor:not-allowed}.save-button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#1b5e20}.error[_ngcontent-%COMP%]{margin-top:.25rem;color:#d32f2f;font-size:.9rem;font-weight:600}.global-error[_ngcontent-%COMP%]{margin-top:1rem;color:#b71c1c;font-weight:700;font-size:1rem}.loading-text[_ngcontent-%COMP%]{text-align:center;font-size:1.2rem;color:#2e7d32}pre[_ngcontent-%COMP%]{background:#f7f7f7;border:1px solid #ccc;padding:.8rem;border-radius:5px;font-size:.8rem;overflow-x:auto;margin-top:1rem}@media (max-width: 768px){.article-creation-page[_ngcontent-%COMP%]{margin:1rem}.article-creation-container[_ngcontent-%COMP%]{flex-direction:column;width:100vw}.form-card[_ngcontent-%COMP%], .editor-card[_ngcontent-%COMP%]{flex:none;width:100%;padding:1rem}.editor-card[_ngcontent-%COMP%]{border-left:none;border-top:1px solid #e0e0e0}.save-button[_ngcontent-%COMP%]{width:100%;align-self:stretch}}.avatar-upload[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-bottom:1rem}.avatar-upload[_ngcontent-%COMP%]   app-upload-image[_ngcontent-%COMP%]{width:200px;height:200px;display:flex;justify-content:center;align-items:center;margin-bottom:1rem}.avatar-upload[_ngcontent-%COMP%]   app-upload-image[_ngcontent-%COMP%]   .avatar-preview[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:100%}.tag-selector-container[_ngcontent-%COMP%]{margin-bottom:2rem}.social-field[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:12px}.social-field[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transition:color .3s ease;cursor:pointer}.social-field.twitter[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#1da1f2}.social-field.linkedin[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#0077b5}.social-field.facebook[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#1877f2}.form-group[_ngcontent-%COMP%]   .character-count[_ngcontent-%COMP%]{font-size:.85em;color:#777;margin-top:5px;text-align:right}.form-group[_ngcontent-%COMP%]   .character-count.error[_ngcontent-%COMP%]{color:#d9534f;font-weight:700}"]})};export{$ as AuthorEditComponent};
