import{a as B,b as L}from"./chunk-Z5H4QDB3.js";import{b as G,c as R}from"./chunk-IMW4E4JM.js";import"./chunk-2WUMKADO.js";import"./chunk-TL62S5XC.js";import{a as z}from"./chunk-S6YN4RDA.js";import{a as j}from"./chunk-IWDVFKXM.js";import{b as I,c as E,e as _,f as U,g as V,i as k,j as F,k as q,p as N,r as K}from"./chunk-UL765BIR.js";import{Ca as P,Da as b,Db as A,Ea as p,Fb as D,O as u,Oa as a,P as f,Pa as y,Qa as M,ea as l,ha as h,ia as w,na as d,qa as s,qb as O,uc as T,vb as S,wa as o,xa as n,ya as m}from"./chunk-NOMZ4WY3.js";import{a as C,b as x,h as v}from"./chunk-MG3ERZGY.js";function Q(i,t){i&1&&m(0,"app-loading-spinner")}function Y(i,t){i&1&&(o(0,"div",29),a(1," Title is required. "),n())}function H(i,t){i&1&&(o(0,"div",29),a(1," Title must be at least 3 characters. "),n())}function W(i,t){i&1&&(o(0,"div",29),a(1," Description is required. "),n())}function X(i,t){i&1&&(o(0,"div",29),a(1," Description must be at least 10 characters. "),n())}function Z(i,t){i&1&&(o(0,"div",29),a(1," Please select at least one tag. "),n())}function $(i,t){if(i&1){let e=P();o(0,"div",30)(1,"button",31),b("click",function(){u(e);let c=p(2);return f(c.discardDraft())}),a(2,"Discard Draft"),n()()}}function ee(i,t){i&1&&(o(0,"div",29),a(1," Content is required. "),n())}function te(i,t){if(i&1&&(o(0,"div",32),a(1),n()),i&2){let e=p(2);l(),y(e.error)}}function ie(i,t){if(i&1){let e=P();o(0,"form",2),b("ngSubmit",function(){u(e);let c=p();return f(c.onSubmit())}),o(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2"),a(5),n(),m(6,"hr"),n(),o(7,"div",6)(8,"div",7)(9,"label",8),a(10,"Title"),n(),m(11,"input",9),d(12,Y,2,0,"div",10)(13,H,2,0,"div",10),n(),o(14,"div",7)(15,"label",11),a(16,"Brief Description"),n(),m(17,"textarea",12),d(18,W,2,0,"div",10)(19,X,2,0,"div",10),n(),o(20,"div",7)(21,"label"),a(22,"Tags"),n(),o(23,"app-tag-selector",13),b("selectedTagsChange",function(c){u(e);let g=p();return f(g.onTagChange(c))}),n(),d(24,Z,2,0,"div",10),n(),o(25,"div",14)(26,"app-upload-image",15),b("imageChange",function(c){u(e);let g=p();return f(g.onImageChange(c))}),n()(),o(27,"div",16)(28,"div",17),m(29,"input",18),o(30,"label",19),a(31,"Feature this article"),n()(),o(32,"div",17),m(33,"input",20),o(34,"label",21),a(35,"Publish immediately"),n()()(),o(36,"div",22),d(37,$,3,0,"div",23),o(38,"button",24),a(39),n()()()(),o(40,"div",25)(41,"div",5)(42,"h3"),a(43,"Article Content"),n(),m(44,"hr"),n(),o(45,"div",7)(46,"label",26),a(47,"Content"),n(),o(48,"quill-editor",27),b("onContentChanged",function(){u(e);let c=p();return f(c.onContentChanged())}),n(),d(49,ee,2,0,"div",10),n(),d(50,te,2,1,"div",28),n()()()}if(i&2){let e=p();s("formGroup",e.form),l(5),y(e.isEditMode?"Edit Article":"Create Article"),l(7),s("ngIf",(e.formSubmitted||e.title.touched||e.title.dirty)&&e.title.hasError("required")),l(),s("ngIf",(e.formSubmitted||e.title.touched||e.title.dirty)&&e.title.hasError("minlength")),l(5),s("ngIf",(e.formSubmitted||e.briefDescription.touched||e.briefDescription.dirty)&&e.briefDescription.hasError("required")),l(),s("ngIf",(e.formSubmitted||e.briefDescription.touched||e.briefDescription.dirty)&&e.briefDescription.hasError("minlength")),l(4),s("selectedTags",e.selectedTags)("tagType","article")("filterOnly",!1),l(),s("ngIf",(e.formSubmitted||e.tags.touched||e.tags.dirty)&&e.tags.hasError("required")),l(2),s("type","thumbnailUrl")("imageUrl",e.avatarUrl),l(11),s("ngIf",e.hasDraft()),l(),s("disabled",e.form.invalid||e.loading),l(),M(" ",e.isEditMode?"Update Article":e.isPublished.value?"Publish Article":"Save Draft"," "),l(10),s("ngIf",(e.formSubmitted||e.content.touched||e.content.dirty)&&e.content.hasError("required")),l(),s("ngIf",e.error)}}function re(i){return(i.value||"").replace(/<[^>]*>/g,"").trim().length===0?{required:!0}:null}function ne(i=1){return t=>{let e=t.value;return Array.isArray(e)&&e.length>=i?null:{required:!0}}}var J=class i{constructor(t,e,r,c,g){this.fb=t;this.router=e;this.route=r;this.articleService=c;this.firebaseService=g}form;error=null;selectedTags=[];formSubmitted=!1;loading=!0;avatarUrl=null;articleId=null;isEditMode=!1;originalArticle=null;draftStorageKeyPrefix="article-upsert-draft-";draftStorageKey;formChangesSubscription;ngOnInit(){return v(this,null,function*(){this.articleId=this.route.snapshot.paramMap.get("id"),this.isEditMode=!!this.articleId,this.draftStorageKey=this.draftStorageKeyPrefix+(this.articleId||"new");try{if(this.form=this.fb.group({title:["",[_.required,_.minLength(3)]],briefDescription:["",[_.required,_.minLength(10)]],content:["",[re]],tags:[[],[ne(1)]],isFeatured:[!1],isPublished:[!1]}),this.isEditMode&&this.articleId){let t=yield this.articleService.getById(this.articleId);if(t){this.originalArticle=t,this.selectedTags=(t.tags||[]).map(r=>({name:r,type:"article"})),this.avatarUrl=t.thumbnailUrl||null;let e=localStorage.getItem(this.draftStorageKey);if(e){let r=JSON.parse(e);this.form.patchValue({title:r.title,briefDescription:r.briefDescription,content:r.content,isFeatured:r.isFeatured??!1,isPublished:r.isPublished??!1}),this.selectedTags=r.selectedTags||this.selectedTags,this.avatarUrl=r.thumbnailUrl||this.avatarUrl}else this.form.patchValue({title:t.title,briefDescription:t.briefDescription,content:t.content,isFeatured:t.isFeatured??!1,isPublished:t.isPublished??!1});this.form.get("tags")?.setValue(this.selectedTags)}else{this.error="Article not found.",this.loading=!1;return}}this.formChangesSubscription=this.form.valueChanges.subscribe(()=>{this.saveDraft()})}catch(t){console.error("Error loading article:",t),this.error="Failed to load article. Please try again."}finally{this.loading=!1}})}ngOnDestroy(){this.formChangesSubscription&&this.formChangesSubscription.unsubscribe()}saveDraft(){let t=x(C({},this.form.value),{selectedTags:this.selectedTags,thumbnailUrl:this.avatarUrl});localStorage.setItem(this.draftStorageKey,JSON.stringify(t))}hasDraft(){return!!localStorage.getItem(this.draftStorageKey)}discardDraft(){localStorage.removeItem(this.draftStorageKey),this.originalArticle?(this.form.patchValue({title:this.originalArticle.title,briefDescription:this.originalArticle.briefDescription,content:this.originalArticle.content,isFeatured:this.originalArticle.isFeatured??!1,isPublished:this.originalArticle.isPublished??!1}),this.selectedTags=(this.originalArticle.tags||[]).map(t=>({name:t,type:"article"})),this.avatarUrl=this.originalArticle.thumbnailUrl||null,this.form.get("tags")?.setValue(this.selectedTags)):(this.form.reset({title:"",briefDescription:"",content:"",tags:[],isFeatured:!1,isPublished:!1}),this.selectedTags=[],this.avatarUrl=null)}get title(){return this.form.get("title")}get briefDescription(){return this.form.get("briefDescription")}get content(){return this.form.get("content")}get tags(){return this.form.get("tags")}get isPublished(){return this.form.get("isPublished")}onContentChanged(){let t=this.content;t.markAsTouched(),t.updateValueAndValidity()}onTagChange(t){this.selectedTags=t;let e=this.tags;e.setValue(t),e.markAsTouched(),e.updateValueAndValidity()}onImageChange(t){this.avatarUrl=t}onSubmit(){return v(this,null,function*(){if(this.formSubmitted=!0,this.form.markAllAsTouched(),!this.form.invalid){this.loading=!0,this.error=null;try{let t=this.firebaseService.auth.currentUser;if(!t){this.error="You must be logged in to create or edit an article.",this.loading=!1;return}let e=this.form.value,r={title:e.title,thumbnailUrl:this.avatarUrl||void 0,briefDescription:e.briefDescription,content:e.content,tags:e.tags.map(c=>c.name),isFeatured:e.isFeatured,updatedAt:new Date};if(e.isPublished?(r.isPublished=!0,!this.originalArticle?.isPublished||!this.originalArticle?.publishDate?r.publishDate=new Date:this.isEditMode&&(r.publishDate=this.originalArticle.publishDate)):(r.isPublished=!1,r.publishDate=null),this.isEditMode&&this.articleId)yield this.articleService.update(this.articleId,r),localStorage.removeItem(this.draftStorageKey),this.router.navigate(["/articles",this.articleId]);else{let c=x(C({},r),{authorId:t.uid,authorName:t.displayName||"Anonymous",publishDate:r.publishDate||null,isPublished:r.isPublished||!1}),g=yield this.articleService.create(c);localStorage.removeItem(this.draftStorageKey),this.router.navigate(["/articles",g])}}catch(t){console.error(t),this.error="Failed to save article. Please try again."}finally{this.loading=!1}}})}static \u0275fac=function(e){return new(e||i)(h(N),h(D),h(A),h(z),h(T))};static \u0275cmp=w({type:i,selectors:[["app-article-create"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","article-creation-page",3,"formGroup","ngSubmit",4,"ngIf"],[1,"article-creation-page",3,"ngSubmit","formGroup"],[1,"article-creation-container"],[1,"form-card"],[1,"card-header"],[1,"article-form"],[1,"form-group"],["for","title"],["id","title","type","text","formControlName","title"],["class","error",4,"ngIf"],["for","briefDescription"],["id","briefDescription","rows","3","formControlName","briefDescription"],[3,"selectedTagsChange","selectedTags","tagType","filterOnly"],[1,"thumbnail-upload-wrapper"],[3,"imageChange","type","imageUrl"],[1,"options-row"],[1,"form-group","checkbox-group"],["type","checkbox","id","isFeatured","formControlName","isFeatured"],["for","isFeatured"],["type","checkbox","id","isPublished","formControlName","isPublished"],["for","isPublished"],[1,"form-actions"],["class","draft-buttons",4,"ngIf"],["type","submit",1,"submit-btn",3,"disabled"],[1,"editor-card"],["for","content"],["formControlName","content",3,"onContentChanged"],["class","global-error",4,"ngIf"],[1,"error"],[1,"draft-buttons"],["type","button",1,"discard-btn",3,"click"],[1,"global-error"]],template:function(e,r){e&1&&d(0,Q,1,0,"app-loading-spinner",0)(1,ie,51,17,"form",1),e&2&&(s("ngIf",r.loading),l(),s("ngIf",!r.loading))},dependencies:[S,O,K,k,E,I,U,V,F,q,R,G,B,j,L],styles:[".article-creation-page[_ngcontent-%COMP%]{display:flex;justify-content:center;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;color:#333;margin:2rem 0}.article-creation-container[_ngcontent-%COMP%]{display:flex;width:90vw;background:#fff;border-radius:8px;box-shadow:0 0 10px #00000026;overflow:hidden}.form-card[_ngcontent-%COMP%]{flex:2;padding:1.5rem 2rem;display:flex;flex-direction:column}.editor-card[_ngcontent-%COMP%]{flex:3;padding:1.5rem 2rem;display:flex;flex-direction:column;border-left:1px solid #e0e0e0;overflow:hidden;min-height:500px;justify-content:space-between}.card-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;font-weight:700;color:#2e7d32}.card-header[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{border:none;border-bottom:2px solid #2e7d32;margin-bottom:1rem;width:50px}.article-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem;display:flex;flex-direction:column;position:relative;padding-bottom:1.5rem}.editor-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:1.5rem;display:flex;flex-direction:column;flex-grow:1;height:100%;min-height:0;position:relative;padding-bottom:1.5rem}label[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.3rem;color:#2e7d32}input[type=text][_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{padding:.5rem .75rem;font-size:1rem;border:1.5px solid #ccc;border-radius:6px;transition:border-color .3s ease;font-family:inherit}input[type=text][_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{border-color:#66bb6a;outline:none;box-shadow:0 0 5px #81c784}quill-editor[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;box-sizing:border-box;word-wrap:break-word;overflow-wrap:break-word;white-space:pre-wrap;flex-grow:1;height:350px;overflow:hidden;border:1.5px solid #ccc;border-radius:6px;transition:border-color .3s ease}quill-editor[_ngcontent-%COMP%]:focus-within{border-color:#66bb6a;outline:none;box-shadow:0 0 5px #81c784}.ql-toolbar[_ngcontent-%COMP%]{border-bottom:1px solid #ccc;background-color:#f7f7f7;border-top-left-radius:5px;border-top-right-radius:5px;flex-shrink:0}.ql-editor[_ngcontent-%COMP%]{word-wrap:break-word;overflow-wrap:break-word;white-space:pre-wrap;flex-grow:1;min-height:100px;overflow-y:auto;padding:.5rem .75rem}.options-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;margin-bottom:1.5rem;padding-top:10px;margin-top:1.5rem}.options-row[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]{flex-direction:row;align-items:center;margin-bottom:0;padding-right:2rem}.checkbox-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:0}.checkbox-group[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-right:.5rem;width:18px;height:18px}app-upload-image[_ngcontent-%COMP%]{width:70%;height:200px;display:block}.thumbnail-upload-wrapper[_ngcontent-%COMP%]{margin:1.5rem auto;text-align:center}app-tag-selector[_ngcontent-%COMP%]{display:block;min-height:50px;margin-bottom:.5rem}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:auto;align-items:center;justify-content:flex-start}.submit-btn[_ngcontent-%COMP%], .discard-btn[_ngcontent-%COMP%]{padding:.6rem 1.6rem;border:none;border-radius:6px;color:#fff;font-weight:700;font-size:1.1rem;cursor:pointer;transition:background-color .3s ease;white-space:nowrap}.submit-btn[_ngcontent-%COMP%]{background-color:#2e7d32}.submit-btn[_ngcontent-%COMP%]:disabled{background-color:#a5d6a7;cursor:not-allowed}.submit-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#1b5e20}.discard-btn[_ngcontent-%COMP%]{background-color:#f44336}.discard-btn[_ngcontent-%COMP%]:disabled{background-color:#ef9a9a;cursor:not-allowed}.discard-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#d32f2f}.draft-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.error[_ngcontent-%COMP%]{color:#d32f2f;font-size:.9rem;font-weight:600;position:absolute;bottom:.25rem;left:0;width:100%;white-space:nowrap;z-index:10}.form-group[_ngcontent-%COMP%]:has(textarea) > .error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]:has(quill-editor) > .error[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]:has(app-tag-selector) > .error[_ngcontent-%COMP%]{bottom:.25rem}.global-error[_ngcontent-%COMP%]{margin-top:1rem;color:#b71c1c;font-weight:700;font-size:1rem}.loading-text[_ngcontent-%COMP%]{text-align:center;font-size:1.2rem;color:#2e7d32}pre[_ngcontent-%COMP%]{background:#f7f7f7;border:1px solid #ccc;padding:.8rem;border-radius:5px;font-size:.8rem;overflow-x:auto;margin-top:1rem}@media (max-width: 768px){.article-creation-page[_ngcontent-%COMP%]{margin:1rem}.article-creation-container[_ngcontent-%COMP%]{flex-direction:column;width:100vw}.form-card[_ngcontent-%COMP%], .editor-card[_ngcontent-%COMP%]{flex:none;width:100%;padding:1rem;min-height:unset}.form-actions[_ngcontent-%COMP%]{flex-direction:column;width:100%;gap:.5rem}.form-actions[_ngcontent-%COMP%]   .submit-btn[_ngcontent-%COMP%], .form-actions[_ngcontent-%COMP%]   .discard-btn[_ngcontent-%COMP%]{width:100%}app-upload-image[_ngcontent-%COMP%]{width:100%;height:auto}.thumbnail-upload-wrapper[_ngcontent-%COMP%]{margin:1.5rem 0}.options-row[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}.options-row[_ngcontent-%COMP%]   .checkbox-group[_ngcontent-%COMP%]{padding-right:0;padding-top:20px}quill-editor[_ngcontent-%COMP%]{height:300px;flex-grow:unset}.editor-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{height:auto}.ql-editor[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto}.article-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{padding-bottom:1.5rem}app-tag-selector[_ngcontent-%COMP%]{min-height:unset;margin-bottom:.5rem}.error[_ngcontent-%COMP%]{position:static;margin-top:.25rem;bottom:unset;left:unset;width:auto;white-space:normal}}"]})};export{J as ArticleUpsertComponent,ne as minTagsSelected,re as quillRequired};
