import{j as Q}from"./chunk-TRGRSSL6.js";import{a as Fe,c as Be}from"./chunk-4YDIKXSZ.js";import"./chunk-TL62S5XC.js";import{a as je}from"./chunk-S6YN4RDA.js";import{a as De}from"./chunk-THAV5HDO.js";import{a as q}from"./chunk-IWDVFKXM.js";import{c as Ve,f as Re,h as Ue,q as ze,r as Le}from"./chunk-UL765BIR.js";import{$a as be,Aa as R,Ca as f,D as fe,Da as u,Db as ke,Ea as r,Fb as Se,G as xe,Na as ee,O as p,Oa as d,P as _,Pa as w,Qa as M,Sa as U,Ta as z,Ua as L,W as ve,Wa as he,Xa as te,_a as ne,ab as ye,ac as P,ba as Z,bb as ie,bc as j,ca as E,cc as F,d as _e,ea as a,ec as T,fc as A,gc as Pe,ha as k,hc as oe,ia as D,ic as Oe,kc as B,lc as re,m as ue,mc as H,na as g,nc as ae,ob as we,pb as $,pc as Ie,qa as m,qb as N,qc as se,r as ge,rc as Te,sa as y,sc as Ae,tc as ce,ub as Me,uc as Ee,vb as W,wa as c,xa as s,y as Ce,ya as h,za as V}from"./chunk-NOMZ4WY3.js";import{h as v}from"./chunk-MG3ERZGY.js";var x=[];for(let n=0;n<256;++n)x.push((n+256).toString(16).slice(1));function $e(n,t=0){return(x[n[t+0]]+x[n[t+1]]+x[n[t+2]]+x[n[t+3]]+"-"+x[n[t+4]]+x[n[t+5]]+"-"+x[n[t+6]]+x[n[t+7]]+"-"+x[n[t+8]]+x[n[t+9]]+"-"+x[n[t+10]]+x[n[t+11]]+x[n[t+12]]+x[n[t+13]]+x[n[t+14]]+x[n[t+15]]).toLowerCase()}var le,qe=new Uint8Array(16);function me(){if(!le){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");le=crypto.getRandomValues.bind(crypto)}return le(qe)}var Xe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),de={randomUUID:Xe};function Ge(n,t,e){if(de.randomUUID&&!t&&!n)return de.randomUUID();n=n||{};let o=n.random??n.rng?.()??me();if(o.length<16)throw new Error("Random bytes length must be >= 16");if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){if(e=e||0,e<0||e+16>t.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let i=0;i<16;++i)t[e+i]=o[i];return t}return $e(o)}var X=Ge;var G=class n{constructor(t){this.firebase=t}commentSubjects=new Map;getComments(t){if(!this.commentSubjects.has(t)){let e=new _e([]);this.commentSubjects.set(t,e),this.listenToComments(t,e)}return this.commentSubjects.get(t).asObservable()}listenToComments(t,e){let o=j(this.firebase.firestore,"comments"),i=T(o,A("articleId","==",t));Ie(i,l=>{let C=[];l.forEach(b=>{C.push(b.data())}),e.next(C)},l=>{console.error("CommentService: Real-time listener error:",l)})}addComment(t,e,o,i,l){return v(this,null,function*(){let C=X(),b={id:C,articleId:t,content:e,userId:o,userName:i,userAvatarUrl:l,createdAt:se(),likes:0,parentId:null,likedBy:[]},O=F(this.firebase.firestore,"comments",C);try{yield re(O,b)}catch(I){throw console.error("CommentService: Error adding comment:",I),I}})}toggleLikeComment(t,e){return v(this,null,function*(){let o=F(this.firebase.firestore,"comments",t);try{let i=yield B(T(j(this.firebase.firestore,"comments"),A("id","==",t)));if(i.empty){console.warn("CommentService: Comment not found for liking:",t);return}(i.docs[0].data().likedBy||[]).includes(e)?yield H(o,{likes:ce(-1),likedBy:Ae(e)}):yield H(o,{likes:ce(1),likedBy:Te(e)})}catch(i){throw console.error("CommentService: Error toggling like for comment:",i),i}})}addReply(t,e,o,i,l,C){return v(this,null,function*(){let b=X(),O={id:b,articleId:t,parentId:e,content:o,userId:i,userName:l,userAvatarUrl:C,createdAt:se(),likes:0,likedBy:[]},I=F(this.firebase.firestore,"comments",b);try{yield re(I,O)}catch(S){throw console.error("CommentService: Error adding reply:",S),S}})}loadMoreComments(t,e=5,o=null,i="newest"){return v(this,null,function*(){let l=j(this.firebase.firestore,"comments"),C,b="createdAt",O="desc";i==="oldest"?O="asc":i==="mostLiked"&&(b="likes",O="desc"),C=T(l,A("articleId","==",t),A("parentId","==",null),Pe(b,O),oe(e));let I=null;if(o){let S=T(l,A("id","==",o),oe(1)),Y=yield B(S);Y.empty?console.warn("CommentService: loadMoreComments: lastVisibleCommentId provided but document not found. Ignoring startAfter."):(I=Y.docs[0],C=T(C,Oe(I)))}try{return(yield B(C)).docs.map(Qe=>Qe.data())}catch(S){throw console.error("CommentService: Error in loadMoreComments:",S),S}})}deleteComment(t){return v(this,null,function*(){let e=j(this.firebase.firestore,"comments"),o=F(e,t);try{yield ae(o);let i=T(e,A("parentId","==",t)),C=(yield B(i)).docs.map(b=>ae(b.ref));yield Promise.all(C)}catch(i){throw console.error("CommentService: Error deleting comment and its replies:",i),i}})}editComment(t,e){return v(this,null,function*(){let o=F(this.firebase.firestore,"comments",t);try{yield H(o,{content:e})}catch(i){throw console.error("CommentService: Error editing comment:",i),i}})}static \u0275fac=function(e){return new(e||n)(xe(Ee))};static \u0275prov=fe({token:n,factory:n.\u0275fac,providedIn:"root"})};var We=n=>({"liked-icon":n});function Ze(n,t){n&1&&h(0,"app-loading-spinner")}function et(n,t){if(n&1&&h(0,"img",20),n&2){let e=r().$implicit;m("src",e.userAvatarUrl,E)}}function tt(n,t){if(n&1&&(V(0),c(1,"p"),d(2),s(),R()),n&2){let e=r().$implicit;a(2),w(e.content)}}function nt(n,t){if(n&1){let e=f();c(0,"textarea",21),L("ngModelChange",function(i){p(e);let l=r(3);return z(l.editContent,i)||(l.editContent=i),_(i)}),s(),c(1,"button",9),u("click",function(){p(e);let i=r().$implicit,l=r(2);return _(l.saveEdit(i.id))}),d(2,"Save"),s(),c(3,"button",9),u("click",function(){p(e);let i=r(3);return _(i.editingCommentId=null)}),d(4,"Cancel"),s()}if(n&2){let e=r(3);U("ngModel",e.editContent)}}function it(n,t){if(n&1){let e=f();c(0,"span",9),u("click",function(){p(e);let i=r().$implicit,l=r(2);return _(l.enableEdit(i))}),d(1,"Edit"),s()}}function ot(n,t){if(n&1){let e=f();c(0,"span",9),u("click",function(){p(e);let i=r().$implicit,l=r(2);return _(l.deleteComment(i.id))}),d(1,"Delete"),s()}}function rt(n,t){if(n&1){let e=f();c(0,"span",9),u("click",function(){p(e);let i=r().$implicit,l=r(2);return _(l.toggleReplies(i.id))}),d(1),s()}if(n&2){let e=r().$implicit,o=r(2);a(),M(" ",o.showReplies[e.id]?"Hide Replies":"View Replies ("+o.getReplies(e.id).length+")"," ")}}function at(n,t){if(n&1){let e=f();c(0,"div",22)(1,"textarea",23),L("ngModelChange",function(i){p(e);let l=r().$implicit,C=r(2);return z(C.replyText[l.id],i)||(C.replyText[l.id]=i),_(i)}),s(),c(2,"button",7),u("click",function(){p(e);let i=r().$implicit,l=r(2);return _(l.postReply(i.id))}),d(3,"Post"),s()()}if(n&2){let e=r().$implicit,o=r(2);a(),U("ngModel",o.replyText[e.id]),a(),m("disabled",!o.replyText[e.id].trim()||!o.userId)}}function st(n,t){if(n&1&&h(0,"img",20),n&2){let e=r().$implicit;m("src",e.userAvatarUrl,E)}}function ct(n,t){if(n&1&&(V(0),c(1,"p"),d(2),s(),R()),n&2){let e=r().$implicit;a(2),w(e.content)}}function lt(n,t){if(n&1){let e=f();c(0,"textarea",21),L("ngModelChange",function(i){p(e);let l=r(5);return z(l.editContent,i)||(l.editContent=i),_(i)}),s(),c(1,"button",9),u("click",function(){p(e);let i=r().$implicit,l=r(4);return _(l.saveEdit(i.id))}),d(2,"Save"),s(),c(3,"button",9),u("click",function(){p(e);let i=r(5);return _(i.editingCommentId=null)}),d(4,"Cancel"),s()}if(n&2){let e=r(5);U("ngModel",e.editContent)}}function mt(n,t){if(n&1){let e=f();c(0,"span",9),u("click",function(){p(e);let i=r().$implicit,l=r(4);return _(l.enableEdit(i))}),d(1,"Edit"),s()}}function dt(n,t){if(n&1){let e=f();c(0,"span",9),u("click",function(){p(e);let i=r().$implicit,l=r(4);return _(l.deleteComment(i.id))}),d(1,"Delete"),s()}}function pt(n,t){if(n&1){let e=f();c(0,"div",22)(1,"textarea",23),L("ngModelChange",function(i){p(e);let l=r().$implicit,C=r(4);return z(C.replyText[l.id],i)||(C.replyText[l.id]=i),_(i)}),s(),c(2,"button",7),u("click",function(){p(e);let i=r().$implicit,l=r(4);return _(l.postReply(i.id))}),d(3,"Post"),s()()}if(n&2){let e=r().$implicit,o=r(4);a(),U("ngModel",o.replyText[e.id]),a(),m("disabled",!o.replyText[e.id].trim()||!o.userId)}}function _t(n,t){if(n&1){let e=f();c(0,"div",25)(1,"div",13),g(2,st,1,1,"img",14),c(3,"strong"),d(4),s(),c(5,"span",15),d(6),s()(),g(7,ct,3,1,"ng-container",16)(8,lt,5,1,"ng-template",null,1,ie),c(10,"div",17)(11,"span",9),u("click",function(){let i=p(e).$implicit,l=r(4);return _(l.likeComment(i))}),c(12,"span",18),d(13,"\u{1F44D}"),s(),d(14),s(),c(15,"span",9),u("click",function(){let i=p(e).$implicit,l=r(4);return _(l.toggleReply(i.id))}),d(16,"Reply"),s(),g(17,mt,2,0,"span",11)(18,dt,2,0,"span",11),s(),g(19,pt,4,2,"div",19),s()}if(n&2){let e=t.$implicit,o=ee(9),i=r(4);a(2),m("ngIf",e.userAvatarUrl),a(2),w(e.userName),a(2),w(i.timeAgo(e.createdAt)),a(),m("ngIf",i.editingCommentId!==e.id)("ngIfElse",o),a(4),y("liked",i.hasUserLiked(e))("disabled-like",!i.userId),a(),m("ngClass",te(14,We,i.hasUserLiked(e))),a(2),M(" ",e.likes," "),a(3),m("ngIf",i.canModifyComment(e)),a(),m("ngIf",i.canModifyComment(e)),a(),m("ngIf",i.replyingTo===e.id)}}function ut(n,t){if(n&1&&(c(0,"div"),g(1,_t,20,16,"div",24),s()),n&2){let e=r().$implicit,o=r(2);a(),m("ngForOf",o.getReplies(e.id))}}function gt(n,t){if(n&1){let e=f();c(0,"div",12)(1,"div",13),g(2,et,1,1,"img",14),c(3,"strong"),d(4),s(),c(5,"span",15),d(6),s()(),g(7,tt,3,1,"ng-container",16)(8,nt,5,1,"ng-template",null,0,ie),c(10,"div",17)(11,"span",9),u("click",function(){let i=p(e).$implicit,l=r(2);return _(l.likeComment(i))}),c(12,"span",18),d(13,"\u{1F44D}"),s(),d(14),s(),c(15,"span",9),u("click",function(){let i=p(e).$implicit,l=r(2);return _(l.toggleReply(i.id))}),d(16,"Reply"),s(),g(17,it,2,0,"span",11)(18,ot,2,0,"span",11)(19,rt,2,1,"span",11),s(),g(20,at,4,2,"div",19)(21,ut,2,1,"div",2),s()}if(n&2){let e=t.$implicit,o=ee(9),i=r(2);a(2),m("ngIf",e.userAvatarUrl),a(2),w(e.userName),a(2),w(i.timeAgo(e.createdAt)),a(),m("ngIf",i.editingCommentId!==e.id)("ngIfElse",o),a(4),y("liked",i.hasUserLiked(e))("disabled-like",!i.userId),a(),m("ngClass",te(16,We,i.hasUserLiked(e))),a(2),M(" ",e.likes," "),a(3),m("ngIf",i.canModifyComment(e)),a(),m("ngIf",i.canModifyComment(e)),a(),m("ngIf",i.getReplies(e.id).length>0),a(),m("ngIf",i.replyingTo===e.id),a(),m("ngIf",i.showReplies[e.id])}}function Ct(n,t){if(n&1){let e=f();c(0,"button",9),u("click",function(){p(e);let i=r(2);return _(i.loadMore())}),d(1,"Load more"),s()}}function ft(n,t){if(n&1){let e=f();c(0,"div",4)(1,"div",5)(2,"textarea",6),L("ngModelChange",function(i){p(e);let l=r();return z(l.newComment,i)||(l.newComment=i),_(i)}),s(),c(3,"button",7),u("click",function(){p(e);let i=r();return _(i.postComment())}),d(4,"Submit"),s()(),c(5,"div",8)(6,"span"),d(7,"Sort by:"),s(),c(8,"button",9),u("click",function(){p(e);let i=r();return _(i.sortComments("newest"))}),d(9,"Newest"),s(),c(10,"button",9),u("click",function(){p(e);let i=r();return _(i.sortComments("oldest"))}),d(11,"Oldest"),s(),c(12,"button",9),u("click",function(){p(e);let i=r();return _(i.sortComments("mostLiked"))}),d(13,"Most Liked"),s()(),g(14,gt,22,18,"div",10)(15,Ct,2,0,"button",11),s()}if(n&2){let e=r();a(2),U("ngModel",e.newComment),a(),m("disabled",!e.newComment.trim()||!e.userId),a(5),y("active",e.currentSort==="newest"),a(2),y("active",e.currentSort==="oldest"),a(2),y("active",e.currentSort==="mostLiked"),a(2),m("ngForOf",e.displayedTopLevelComments),a(),m("ngIf",e.hasMore)}}var J=class n{constructor(t,e){this.commentService=t;this.authService=e}articleId;allComments=[];displayedTopLevelComments=[];newComment="";replyingTo=null;replyText={};userId=null;userName="";userAvatarUrl="";isAdmin=!1;showReplies={};editingCommentId=null;editContent="";hasMore=!0;pageSize=5;loadingAuthAndComments=!0;currentSort="newest";realTimeCommentsSubscription;authSubscription;currentDisplayedCount=0;ngOnInit(){return v(this,null,function*(){this.authSubscription=ue([this.authService.authReady$.pipe(ge(t=>t)),this.authService.user$]).subscribe(([t,e])=>{e?(this.userId=e.uid,this.userName=e.displayName??"Anonymous",this.userAvatarUrl=e.photoURL??"",this.isAdmin=e.roles?.admin===!0):(this.userId=null,this.userName="Anonymous",this.userAvatarUrl="",this.isAdmin=!1),this.realTimeCommentsSubscription||this.setupRealTimeCommentsListener(),this.loadingAuthAndComments=!1},t=>{console.error("CommentsComponent: Auth subscription error:",t),this.loadingAuthAndComments=!1})})}ngOnDestroy(){this.realTimeCommentsSubscription&&this.realTimeCommentsSubscription.unsubscribe(),this.authSubscription&&this.authSubscription.unsubscribe()}setupRealTimeCommentsListener(){this.realTimeCommentsSubscription=this.commentService.getComments(this.articleId).subscribe(t=>{this.allComments=t,this.updateDisplayedComments()},t=>{console.error("CommentsComponent: Error fetching real-time comments:",t)})}updateDisplayedComments(){let t=this.allComments.filter(e=>e.parentId===null);t.sort((e,o)=>{if(this.currentSort==="newest"){let i=e.createdAt instanceof P?e.createdAt.toMillis():0;return(o.createdAt instanceof P?o.createdAt.toMillis():0)-i}else if(this.currentSort==="oldest"){let i=e.createdAt instanceof P?e.createdAt.toMillis():0,l=o.createdAt instanceof P?o.createdAt.toMillis():0;return i-l}else if(this.currentSort==="mostLiked")return o.likes-e.likes;return 0}),(this.currentDisplayedCount===0||this.currentDisplayedCount<this.pageSize)&&(this.currentDisplayedCount=this.pageSize),this.currentDisplayedCount>t.length&&(this.currentDisplayedCount=t.length),this.displayedTopLevelComments=t.slice(0,this.currentDisplayedCount),this.hasMore=t.length>this.displayedTopLevelComments.length}loadMore(){this.currentDisplayedCount+=this.pageSize,this.updateDisplayedComments()}sortComments(t){this.currentSort=t,this.currentDisplayedCount=this.pageSize,this.updateDisplayedComments()}canModifyComment(t){return this.isAdmin||t.userId===this.userId}enableEdit(t){this.canModifyComment(t)?(this.editingCommentId=t.id,this.editContent=t.content):console.warn("User not authorized to edit this comment.")}saveEdit(t){return v(this,null,function*(){let e=this.allComments.find(o=>o.id===t);if(!e||!this.canModifyComment(e)){console.error("CommentsComponent: Unauthorized attempt to save edit or comment not found.");return}yield this.commentService.editComment(t,this.editContent),this.editingCommentId=null})}deleteComment(t){return v(this,null,function*(){let e=this.allComments.find(o=>o.id===t);if(!e||!this.canModifyComment(e)){console.error("CommentsComponent: Unauthorized attempt to delete comment or comment not found.");return}if(confirm("Are you sure you want to delete this comment and all its replies?"))try{yield this.commentService.deleteComment(t)}catch(o){console.error("CommentsComponent: Error deleting comment:",o)}})}toggleReplies(t){this.showReplies[t]=!this.showReplies[t]}postComment(){return v(this,null,function*(){if(!this.userId){console.warn("CommentsComponent: User not logged in to post comments.");return}if(this.newComment.trim())try{yield this.commentService.addComment(this.articleId,this.newComment,this.userId,this.userName,this.userAvatarUrl),this.newComment=""}catch(t){console.error("CommentsComponent: Error posting comment:",t)}})}postReply(t){return v(this,null,function*(){if(!this.userId){console.warn("CommentsComponent: User not logged in to post replies.");return}let e=this.replyText[t];if(e?.trim())try{yield this.commentService.addReply(this.articleId,t,e,this.userId,this.userName,this.userAvatarUrl),this.replyText[t]="",this.replyingTo=null,this.showReplies[t]=!0}catch(o){console.error("CommentsComponent: Error posting reply:",o)}})}toggleReply(t){this.replyingTo=this.replyingTo===t?null:t}likeComment(t){return v(this,null,function*(){if(!this.userId){console.warn("CommentsComponent: User not logged in to like comments.");return}yield this.commentService.toggleLikeComment(t.id,this.userId)})}hasUserLiked(t){return this.userId&&t.likedBy?.includes(this.userId)||!1}getReplies(t){return this.allComments.filter(e=>e.parentId===t).sort((e,o)=>{let i=e.createdAt instanceof P?e.createdAt.toMillis():0,l=o.createdAt instanceof P?o.createdAt.toMillis():0;return i-l})}timeAgo(t){if(!t||!(t instanceof P))return"Invalid date";let e=(Date.now()-t.toMillis())/1e3;return e<60?"just now":e<3600?`${Math.floor(e/60)}m ago`:e<86400?`${Math.floor(e/3600)}h ago`:`${Math.floor(e/86400)}d ago`}static \u0275fac=function(e){return new(e||n)(k(G),k(Q))};static \u0275cmp=D({type:n,selectors:[["app-comments"]],inputs:{articleId:"articleId"},decls:2,vars:2,consts:[["editForm",""],["editReplyForm",""],[4,"ngIf"],["class","comments-container",4,"ngIf"],[1,"comments-container"],[1,"comment-input"],["placeholder","Add a comment...","rows","2",3,"ngModelChange","ngModel"],[3,"click","disabled"],[1,"sort-options"],[3,"click"],["class","comment",4,"ngFor","ngForOf"],[3,"click",4,"ngIf"],[1,"comment"],[1,"comment-header"],["class","avatar",3,"src",4,"ngIf"],[1,"timestamp"],[4,"ngIf","ngIfElse"],[1,"comment-actions"],[3,"ngClass"],["class","reply-box",4,"ngIf"],[1,"avatar",3,"src"],["rows","2",3,"ngModelChange","ngModel"],[1,"reply-box"],["placeholder","Reply...","rows","2",3,"ngModelChange","ngModel"],["class","reply",4,"ngFor","ngForOf"],[1,"reply"]],template:function(e,o){e&1&&g(0,Ze,1,0,"app-loading-spinner",2)(1,ft,16,10,"div",3),e&2&&(m("ngIf",o.loadingAuthAndComments),a(),m("ngIf",!o.loadingAuthAndComments))},dependencies:[W,we,$,N,ze,Ve,Re,Ue,q],styles:[".comments-container[_ngcontent-%COMP%]{padding:0 0 20px}.comment-input[_ngcontent-%COMP%]{display:flex;gap:10px;margin-bottom:20px}.comment-input[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{flex-grow:1;padding:10px;border:1px solid #ddd;border-radius:4px;resize:vertical}.comment-input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 15px;border-radius:4px;cursor:pointer;transition:background-color .3s ease}.comment-input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0056b3}.comment-input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.sort-options[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:20px;font-size:.9em;color:#555}.sort-options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#f0f0f0;color:#333;border:1px solid #ddd;padding:8px 12px;border-radius:4px;cursor:pointer;transition:all .3s ease}.sort-options[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.sort-options[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border-color:#007bff}.comment[_ngcontent-%COMP%]{background-color:#f9f9f9;border:1px solid #eee;border-radius:8px;padding:15px;margin-bottom:15px}.comment-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px;font-size:.9em;color:#555}.comment-header[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:30px;height:30px;border-radius:50%;margin-right:10px;object-fit:cover}.comment-header[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{margin-right:5px;color:#333}.timestamp[_ngcontent-%COMP%]{color:#999;font-size:.8em;margin-left:auto}.comment[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:10px;line-height:1.5;color:#333}.comment-actions[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:15px;color:#007bff;cursor:pointer;font-size:.9em}.comment-actions[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{text-decoration:underline}.reply-box[_ngcontent-%COMP%]{margin-top:10px;display:flex;gap:10px}.reply-box[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{flex-grow:1;padding:8px;border:1px solid #ddd;border-radius:4px;resize:vertical}.reply-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;transition:background-color .3s ease}.reply-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#218838}.reply-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}.reply[_ngcontent-%COMP%]{background-color:#f0f2f5;border-left:3px solid #ccc;padding:10px;margin-top:10px;margin-left:20px;border-radius:4px}.reply[_ngcontent-%COMP%]   .comment-header[_ngcontent-%COMP%]{font-size:.85em}.reply[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9em}textarea[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;margin-bottom:10px;box-sizing:border-box}button[_ngcontent-%COMP%]{padding:8px 15px;border:none;border-radius:4px;cursor:pointer;font-size:.9em;margin-right:10px}button[_ngcontent-%COMP%]:last-child{margin-right:0}.comment-actions[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer;margin-right:10px;color:#555;transition:color .2s ease-in-out}.comment-actions[_ngcontent-%COMP%]   span.liked[_ngcontent-%COMP%]{color:#007bff;font-weight:700}.comment-actions[_ngcontent-%COMP%]   span.liked-icon[_ngcontent-%COMP%]{filter:grayscale(0%)}.comment-actions[_ngcontent-%COMP%]   span.disabled-like[_ngcontent-%COMP%]{cursor:not-allowed;opacity:.6}"]})};var K=class n{visible=!1;articleId;closed=new ve;close(){this.closed.emit()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=D({type:n,selectors:[["app-comment-panel"]],inputs:{visible:"visible",articleId:"articleId"},outputs:{closed:"closed"},decls:7,vars:3,consts:[[1,"comment-panel"],[1,"header"],[3,"click"],[3,"articleId"]],template:function(e,o){e&1&&(c(0,"div",0)(1,"div",1)(2,"h3"),d(3,"Comments"),s(),c(4,"button",2),u("click",function(){return o.close()}),d(5,"\xD7"),s()(),h(6,"app-comments",3),s()),e&2&&(y("open",o.visible),a(6),m("articleId",o.articleId))},dependencies:[J],styles:[".comment-panel[_ngcontent-%COMP%]{position:fixed;top:0;right:-400px;width:400px;height:100%;background-color:#fff;box-shadow:-2px 0 5px #0003;transition:right .3s ease-in-out;z-index:1000;display:flex;flex-direction:column}.comment-panel.open[_ngcontent-%COMP%]{right:0}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;border-bottom:1px solid #eee;background-color:#f8f8f8}.header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.3em;color:#333}.header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;border:none;font-size:1.8em;cursor:pointer;color:#666}.header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#333}app-comments[_ngcontent-%COMP%]{flex-grow:1;overflow-y:auto;padding:20px}"]})};var xt=()=>[];function vt(n,t){n&1&&h(0,"app-loading-spinner")}function ht(n,t){if(n&1&&h(0,"img",20),n&2){let e=r(3);m("src",e.author.avatarUrl,E)}}function bt(n,t){if(n&1&&h(0,"p",21),n&2){let e=r(3);m("innerHTML",e.author.bio,Z)}}function yt(n,t){if(n&1){let e=f();c(0,"div",14)(1,"div",15),d(2,"About the Author"),s(),c(3,"div",16),g(4,ht,1,1,"img",17),c(5,"h3",18),u("click",function(){p(e);let i=r(2);return _(i.goToAuthorDetails(i.author.id))}),d(6),s(),g(7,bt,1,1,"p",19),s()()}if(n&2){let e=r(2);a(4),m("ngIf",e.author.avatarUrl),a(2),M(" ",e.author.name," "),a(),m("ngIf",e.author.bio)}}function wt(n,t){if(n&1&&h(0,"img",22),n&2){let e=r(2);m("src",e.article.thumbnailUrl,E)}}function Mt(n,t){if(n&1&&(c(0,"span"),d(1),s()),n&2){let e=r(3);a(),M(" | \u{1F44D} ",e.article.likesCount," likes")}}function kt(n,t){if(n&1&&(c(0,"span"),d(1),s()),n&2){let e=r(3);a(),M(" | \u{1F4AC} ",e.article.commentsCount," comments")}}function St(n,t){if(n&1&&(c(0,"span",30),d(1),s()),n&2){let e=t.$implicit;a(),M("#",e,"")}}function Pt(n,t){if(n&1&&(c(0,"div",28),g(1,St,2,1,"span",29),s()),n&2){let e=r(3);a(),m("ngForOf",e.article.tags)}}function Ot(n,t){if(n&1){let e=f();c(0,"div")(1,"div",23)(2,"p",24),d(3," By "),c(4,"strong",18),u("click",function(){p(e);let i=r(2);return _(i.goToAuthorDetails(i.author==null?null:i.author.id))}),d(5),s(),d(6),ne(7,"articleDate"),ne(8,"date"),s(),c(9,"p",25),g(10,Mt,2,1,"span",0)(11,kt,2,1,"span",0),s()(),g(12,Pt,2,1,"div",26),c(13,"p",27),d(14),s()()}if(n&2){let e=r(2);a(5),w(e.author==null?null:e.author.name),a(),M(" on ",ye(8,8,be(7,6,e.article),"mediumDate")," "),a(4),m("ngIf",e.article.likesCount),a(),m("ngIf",e.article.commentsCount),a(),m("ngIf",e.article.tags==null?null:e.article.tags.length),a(2),w(e.article.briefDescription)}}function It(n,t){if(n&1&&h(0,"div",31),n&2){let e=r(2);m("innerHTML",e.article.content,Z)}}function Tt(n,t){if(n&1){let e=f();c(0,"div",32)(1,"button",33),u("click",function(){p(e);let i=r(2);return _(i.goToEdit())}),d(2,"\u270F\uFE0F Edit Article"),s()()}}function At(n,t){if(n&1){let e=f();V(0),c(1,"button",34),u("click",function(){p(e);let i=r(2);return _(i.showComments=!0)}),d(2," \u{1F4AC} Add a comment "),s(),R()}}function Et(n,t){if(n&1){let e=f();c(0,"div",3),g(1,yt,8,3,"div",4),c(2,"div",5)(3,"div",6),g(4,wt,1,1,"img",7),c(5,"h1",8),d(6),s(),c(7,"div",9)(8,"button",10),u("click",function(){p(e);let i=r();return _(i.selectTab("overview"))}),d(9," Overview "),s(),c(10,"button",10),u("click",function(){p(e);let i=r();return _(i.selectTab("content"))}),d(11," Content "),s()(),c(12,"div",11),g(13,Ot,15,11,"div",0)(14,It,1,1,"div",12),s()(),g(15,Tt,3,0,"div",13)(16,At,3,0,"ng-container",0),s()()}if(n&2){let e=r();a(),m("ngIf",e.author),a(3),m("ngIf",e.article.thumbnailUrl),a(2),w(e.article.title),a(2),y("active",e.selectedTab==="overview"),a(2),y("active",e.selectedTab==="content"),a(3),m("ngIf",e.selectedTab==="overview"),a(),m("ngIf",e.selectedTab==="content"),a(),m("ngIf",e.canEdit),a(),m("ngIf",e.article==null?null:e.article.id)}}function Dt(n,t){if(n&1){let e=f();V(0),c(1,"app-comment-panel",35),u("closed",function(){p(e);let i=r();return _(i.showComments=!1)}),s(),R()}if(n&2){let e=t.ngIf,o=r();a(),m("visible",o.showComments)("articleId",e)}}function Vt(n,t){if(n&1&&h(0,"app-article-list-carousel",36),n&2){let e=r();m("headerText","Related Articles")("currentArticleId",e.article.id)("currentArticleTags",e.article.tags||he(4,xt))("currentArticleAuthorId",e.article.authorId)}}var He=class n{constructor(t,e,o,i,l){this.route=t;this.router=e;this.articleService=o;this.authorService=i;this.authService=l}article=null;author=null;canEdit=!1;loading=!0;showComments=!1;selectedTab="overview";authSubscription;routeSubscription;ngOnInit(){this.routeSubscription=this.route.paramMap.pipe(Ce(t=>{this.loading=!0;let e=t.get("id");return e?this.articleService.getById(e):(this.loading=!1,Promise.resolve(null))})).subscribe({next:t=>{if(!t){console.warn("Article not found"),this.loading=!1,this.article=null,this.author=null;return}this.article=t,this.selectedTab="overview",t.authorId?this.authorService.getById(t.authorId).then(e=>{this.author=e,this.checkEditPermissions()}).catch(e=>{console.error("Error loading author:",e),this.author=null,this.checkEditPermissions()}):(this.author=null,this.checkEditPermissions())},error:t=>{console.error("Error loading article details:",t),this.loading=!1,this.article=null,this.author=null}})}checkEditPermissions(){this.authSubscription=this.authService.user$.subscribe(t=>{t?t.roles?.admin?this.canEdit=!0:t.roles?.author&&t.uid===this.author?.id?this.canEdit=!0:this.canEdit=!1:this.canEdit=!1,this.loading=!1})}ngOnDestroy(){this.authSubscription&&this.authSubscription.unsubscribe(),this.routeSubscription&&this.routeSubscription.unsubscribe()}selectTab(t){this.selectedTab=t}goToEdit(){this.article?.id&&this.router.navigate(["/edit-article",this.article.id])}goToAuthorDetails(t){t&&this.router.navigate(["/author",t])}static \u0275fac=function(e){return new(e||n)(k(ke),k(Se),k(je),k(De),k(Q))};static \u0275cmp=D({type:n,selectors:[["app-article-details"]],decls:4,vars:4,consts:[[4,"ngIf"],["class","article-page-layout",4,"ngIf"],[3,"headerText","currentArticleId","currentArticleTags","currentArticleAuthorId",4,"ngIf"],[1,"article-page-layout"],["class","author-sidebar",4,"ngIf"],[1,"article-details-content"],[1,"article-card"],["alt","Article image","class","article-thumbnail",3,"src",4,"ngIf"],[1,"article-main-title"],[1,"tabs"],[1,"tab-button",3,"click"],[1,"tab-content"],["class","article-content",3,"innerHTML",4,"ngIf"],["class","article-card-footer",4,"ngIf"],[1,"author-sidebar"],[1,"about-author-header"],[1,"author-profile-card"],["alt","Author Avatar","class","author-avatar-large",3,"src",4,"ngIf"],[1,"author-name-clickable",3,"click"],["class","author-bio",3,"innerHTML",4,"ngIf"],["alt","Author Avatar",1,"author-avatar-large",3,"src"],[1,"author-bio",3,"innerHTML"],["alt","Article image",1,"article-thumbnail",3,"src"],[1,"article-meta"],[1,"article-author"],[1,"article-info"],["class","article-tags",4,"ngIf"],[1,"article-brief-description"],[1,"article-tags"],["class","tag-chip",4,"ngFor","ngForOf"],[1,"tag-chip"],[1,"article-content",3,"innerHTML"],[1,"article-card-footer"],[1,"edit-btn",3,"click"],[1,"show-comments-btn",3,"click"],[3,"closed","visible","articleId"],[3,"headerText","currentArticleId","currentArticleTags","currentArticleAuthorId"]],template:function(e,o){e&1&&g(0,vt,1,0,"app-loading-spinner",0)(1,Et,17,11,"div",1)(2,Dt,2,2,"ng-container",0)(3,Vt,1,5,"app-article-list-carousel",2),e&2&&(m("ngIf",o.loading),a(),m("ngIf",!o.loading&&o.article),a(),m("ngIf",o.article==null?null:o.article.id),a(),m("ngIf",o.article))},dependencies:[Le,W,$,N,Me,q,Fe,K,Be],styles:[".article-page-layout[_ngcontent-%COMP%]{display:flex;gap:2rem;max-width:1200px;margin:2rem auto;padding:1rem;align-items:flex-start}.author-sidebar[_ngcontent-%COMP%]{flex:0 0 25%;min-width:200px;background:#fff;padding:1.5rem;border-radius:16px;box-shadow:0 4px 12px #0000001a;text-align:center;position:sticky;top:2rem;align-self:flex-start;overflow-y:visible}.author-profile-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;margin-top:.5rem;margin-bottom:.5rem;color:#333}.author-avatar-large[_ngcontent-%COMP%]{width:200px;height:200px;border-radius:50%;object-fit:cover;border:0 solid #00796b;margin:0 auto;display:block}.following-button[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;padding:8px 15px;border:none;border-radius:20px;cursor:pointer;font-size:.9em;margin-bottom:10px;transition:background-color .3s ease}.following-button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.follow-recommendations-text[_ngcontent-%COMP%]{font-size:.8em;color:#777;margin-bottom:1.5rem}.about-author-header[_ngcontent-%COMP%]{font-size:1.1em;font-weight:700;color:#333;text-align:left;margin-bottom:10px;border-top:1px solid #eee;padding-top:15px}.author-bio[_ngcontent-%COMP%]{font-size:.9em;line-height:1.6;color:#555;text-align:left;margin-bottom:1.5rem;word-wrap:break-word;overflow-wrap:break-word;word-break:normal;white-space:normal}.author-social-links[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:15px;margin-top:1rem}.author-social-links[_ngcontent-%COMP%]   .social-icon[_ngcontent-%COMP%]{width:24px;height:24px;fill:#666;transition:fill .3s ease}.author-social-links[_ngcontent-%COMP%]   a[aria-label=Twitter][_ngcontent-%COMP%]   .social-icon[_ngcontent-%COMP%]{fill:#1da1f2}.author-social-links[_ngcontent-%COMP%]   a[aria-label=LinkedIn][_ngcontent-%COMP%]   .social-icon[_ngcontent-%COMP%]{fill:#0077b5}.author-social-links[_ngcontent-%COMP%]   a[aria-label=Facebook][_ngcontent-%COMP%]   .social-icon[_ngcontent-%COMP%]{fill:#1877f2}.article-details-content[_ngcontent-%COMP%]{flex:1;min-width:0}.article-card[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:16px;box-shadow:0 4px 12px #0000001a;overflow-wrap:break-word;word-break:break-word;position:relative;display:flex;flex-direction:column}.article-thumbnail[_ngcontent-%COMP%]{width:100%;border-radius:12px;margin-bottom:1.5rem;object-fit:cover}.article-main-title[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:1.5rem;text-align:center;color:#333;overflow-wrap:break-word;word-break:break-word}.article-title[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:.5rem}.article-author[_ngcontent-%COMP%]{font-style:italic;color:#555}.article-info[_ngcontent-%COMP%]{margin-bottom:1rem;color:#777;font-size:.95rem}.article-tags[_ngcontent-%COMP%]{margin:1rem 0}.tag-chip[_ngcontent-%COMP%]{display:inline-block;background-color:#e0f2f1;color:#00796b;padding:4px 10px;border-radius:20px;font-size:.85rem;margin:4px 4px 0 0}.article-content[_ngcontent-%COMP%]{line-height:1.7;color:#333;overflow-wrap:break-word;word-break:normal;white-space:normal;padding-top:1rem}.article-brief-description[_ngcontent-%COMP%]{margin-top:1rem;font-size:1.1em;color:#444;line-height:1.6;word-wrap:break-word;overflow-wrap:break-word;word-break:normal;white-space:normal}.article-card-footer[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1rem;border-top:1px solid #eee;text-align:right}.edit-btn[_ngcontent-%COMP%]{background-color:#00796b;color:#fff;padding:.5rem 1rem;border-radius:6px;border:none;cursor:pointer;font-size:.95rem}.edit-btn[_ngcontent-%COMP%]:hover{background-color:#004d40}.author-info[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:.8em;color:#888}.author-avatar[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:50%;object-fit:cover;margin-right:6px}.author-details-tab[_ngcontent-%COMP%]{display:none}.meta-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:auto;min-height:25px}.show-comments-btn[_ngcontent-%COMP%]{position:fixed;right:1rem;bottom:1rem;background-color:#4f46e5;color:#fff;padding:.6rem 1rem;border-radius:6px;border:none;cursor:pointer;box-shadow:0 2px 8px #0003;z-index:100}.tabs[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:2rem;border-bottom:1px solid #eee}.tab-button[_ngcontent-%COMP%]{background-color:transparent;border:none;padding:12px 20px;cursor:pointer;font-size:1.1rem;color:#666;transition:all .3s ease;border-bottom:3px solid transparent}.tab-button[_ngcontent-%COMP%]:hover{color:#00796b}.tab-button.active[_ngcontent-%COMP%]{color:#00796b;border-bottom:3px solid #00796b;font-weight:700}.tab-content[_ngcontent-%COMP%]{padding:1.5rem 0}.social-field[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:12px}.social-field[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transition:color .3s ease;cursor:pointer}.social-field.twitter[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#1da1f2}.social-field.linkedin[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#0077b5}.social-field.facebook[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{color:#1877f2}.author-name-clickable[_ngcontent-%COMP%]{cursor:pointer;color:#00796b;text-decoration:underline}.author-name-clickable[_ngcontent-%COMP%]:hover{color:#004d40}@media (max-width: 768px){.article-page-layout[_ngcontent-%COMP%]{flex-direction:column;gap:1.5rem}.author-sidebar[_ngcontent-%COMP%]{position:static;width:100%;order:-1;margin-bottom:1.5rem;max-height:none;overflow-y:visible;flex:0 0 auto}.article-details-content[_ngcontent-%COMP%]{width:100%;box-sizing:border-box}}"]})};export{He as ArticleDetailsComponent};
